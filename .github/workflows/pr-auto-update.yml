name: Auto-update PRs
on:
  push:
    branches:
      - "main"

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Update PRs
        run: |
          # List only PRs that are open and not draft
          OPEN_PRS=$(gh pr list --base master --state open --json number,isDraft --jq '.[] | select(.isDraft==false) | .number')
          
          # Check if there are any PRs to update
          if [ -z "$OPEN_PRS" ]; then
            echo "No open PRs to update"
            exit 0
          fi
          
          # Update each PR
          for PR_NUM in $OPEN_PRS; do
            echo "Updating PR #$PR_NUM"
            gh pr update-branch $PR_NUM --repo ${{ github.repository }} || echo "Failed to update PR #$PR_NUM"
          done
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
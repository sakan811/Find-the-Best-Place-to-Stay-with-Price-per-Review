name: Build and Upload Artifacts for Find Place Hotel Web App

on:
  push:
    branches:
      - main  # Trigger on push to the main branch
  workflow_dispatch:  # Allows manual trigger from GitHub UI
  schedule:
    - cron: "0 0 */89 * *"  # Run every 89 days at midnight UTC

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # Set up Go environment
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.21

      # Initialize Go modules (if go.mod doesn't exist, it will create it)
      - name: Initialize Go Module
        run: |
          if [ ! -f go.mod ]; then
            echo "Initializing Go module"
            go mod init github.com/${{ github.repository }}
          fi
          go mod tidy
          
      # Build Go binary for different platforms directly to the root of the repo
      - name: Build Binaries
        run: |
          echo "Building Linux binary"
          GOOS=linux GOARCH=amd64 go build -o find_place_hotel_web_app-linux-amd64 get_auth_headers.go
          
          echo "Building macOS Intel binary"
          GOOS=darwin GOARCH=amd64 go build -o find_place_hotel_web_app-darwin-amd64 get_auth_headers.go

          echo "Building macOS Apple Silicon binary"
          GOOS=darwin GOARCH=arm64 go build -o find_place_hotel_web_app-darwin-arm64 get_auth_headers.go

          echo "Building Windows binary"
          GOOS=windows GOARCH=amd64 go build -o find_place_hotel_web_app-windows-amd64.exe

      # Upload the binaries as artifacts
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Find Place Hotel Web App Binaries
          path: |
            find_place_hotel_web_app-linux-amd64
            find_place_hotel_web_app-darwin-amd64
            find_place_hotel_web_app-darwin-arm64
            find_place_hotel_web_app-windows-amd64.exe
